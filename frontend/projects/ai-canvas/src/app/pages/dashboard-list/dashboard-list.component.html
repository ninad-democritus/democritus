<div class="dashboard-view-container">
  <!-- Page Header -->
  <div class="page-header" *ngIf="!loading && !error">
    <div class="header-content">
      <h1 class="page-title">View Dashboards</h1>
    </div>
    <button class="btn-create" (click)="createNewDashboard()">
      <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      Create Dashboard
    </button>
  </div>

  <!-- Filter Bar -->
  <div class="filter-bar" *ngIf="!loading && !error">
    <div class="scope-toggles">
      <button 
        [class.active]="activeScope === 'my'"
        (click)="onScopeChange('my')">
        My Dashboards
      </button>
      <button 
        [class.active]="activeScope === 'public'"
        (click)="onScopeChange('public')">
        Public
      </button>
    </div>
    
    <div class="search-bar">
      <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input 
        type="text" 
        placeholder="Search dashboards..."
        [(ngModel)]="searchQuery"
        (input)="onSearchChange(searchQuery)" />
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading dashboards...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <svg class="error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="loadDashboards()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && dashboards.length === 0" class="empty-state">
    <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path>
    </svg>
    <h2>No dashboards found</h2>
    <p>Create your first dashboard to get started</p>
    <button class="btn-create-large" (click)="createNewDashboard()">
      <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      Create Your First Dashboard
    </button>
  </div>

  <!-- Dashboard Grid -->
  <div *ngIf="!loading && !error && dashboards.length > 0" class="dashboard-grid">
    <div *ngFor="let dashboard of dashboards" class="dashboard-card">
      
      <!-- Card Header -->
      <div class="card-header">
        <h3 class="dashboard-name">{{ dashboard.name }}</h3>
        <span class="badge" [class.private]="dashboard.visibility === 'private'">
          {{ dashboard.visibility }}
        </span>
        <div class="action-icons">
          <button 
            class="btn-icon btn-view" 
            (click)="viewDashboard($event, dashboard.id)" 
            title="View dashboard">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
          </button>
          
          <button 
            class="btn-icon btn-edit" 
            (click)="editDashboard($event, dashboard.id)" 
            title="Edit dashboard">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
          </button>
          
          <button 
            class="btn-icon btn-delete" 
            (click)="deleteDashboard($event, dashboard.id)" 
            title="Delete dashboard">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Card Body: Widget Layout Preview -->
      <div class="card-body">
        <div class="widget-grid-preview" *ngIf="dashboard.widgets_preview && dashboard.widgets_preview.length > 0">
          <div *ngFor="let widget of dashboard.widgets_preview"
               class="widget-preview-box"
               [attr.data-chart-type]="widget.chart_type"
               [style.grid-column]="(widget.position.x + 1) + ' / span ' + widget.size.cols"
               [style.grid-row]="(widget.position.y + 1) + ' / span ' + widget.size.rows">
            
            <svg class="chart-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getChartIcon(widget.chart_type)"></path>
            </svg>
            
            <span class="widget-name">{{ widget.name }}</span>
          </div>
        </div>
        
        <div class="empty-preview" *ngIf="!dashboard.widgets_preview || dashboard.widgets_preview.length === 0">
          <p>No widgets yet</p>
        </div>
      </div>

      <!-- Card Footer -->
      <div class="card-footer">
        <div class="meta-info">
          <span class="meta-item">
            <svg class="meta-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            {{ dashboard.widget_count }} widget{{ dashboard.widget_count !== 1 ? 's' : '' }}
          </span>
          <span class="meta-item type-badge">
            {{ dashboard.dashboard_type | titlecase }}
          </span>
        </div>
        <div class="timestamp">
          {{ formatDate(dashboard.updated_at) }}
        </div>
      </div>
    </div>
  </div>
</div>
